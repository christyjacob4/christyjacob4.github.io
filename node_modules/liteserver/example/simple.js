var LS = require('../index');
var config = require('./config');
var Path = require('path');
var argv = process.argv;
if(argv[2]){
  config.port = argv[2];
}
var serv = LS.create(config);
var log = LS.Log.create({
  sys:{
    level:"DEBUG",
    duration:1
  }
});
serv.router({
  '/done':function (req, res) {res.done(req.url); },
  '/json':function (req, res) {res.json({url: req.url}); },
  '/text':function (req, res) {res.text(req.url); },
  '/jsonp':function (req, res) {res.jsonp('test', {url: req.url}); },
  '/cookie': function (req, res) {
    res.setCookie('a','1');
    res.setCookie('b','2');
    res.done('sdf');
  },
  '/dispatch': function (req, res, config) {
    var router = req.getRouter();
    req.dispatch(router.action, Actions);  
  },
  '/':function(req,res){
    res.end(req.url);
  }
}).setLog(log);

var Actions = {
  $default : function (req, res, config) {
    res.end('default');
  },
  $test : function (req, res, config) {
    console.log('test');
    res.req = req;
    req.res = res;
    res.end('test');
  }
};

serv.start();

process.on('uncaughtException', function(err){
  console.log('process uncaughtException', err.stack);
});
